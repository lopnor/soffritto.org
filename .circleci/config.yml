version: 2
jobs:
    build:
        docker:
            - image: perl:latest
        steps:
            - checkout
            - restore-cache:
                keys:
                    - cpanm-{{ checksum ".circleci/cpanm.sh" }}
            - run: sh .circleci/cpanm.sh
            - save-cache:
                key: cpanm-{{ checksum ".circleci/cpanm.sh" }}
                paths:
                    - /usr/local/lib/perl5
                    - /usr/local/bin
            - restore-cache:
                keys:
                    - carton-{{ checksum "cpanfile.snapshot" }}
            - run: carton install --deployment
            - save-cache:
                key: carton-{{ checksum "cpanfile.snapshot" }}
                paths:
                    - local
            - run: carton exec -- nim
